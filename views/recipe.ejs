<%- include('partials/header') -%>
<div class="container">
  <div class="row justify-content-center mt-5">
    <div class="col-6">
      <img class="img-fluid" src="<%= recipe.image%>" />
      <div class="row justify-content-between">
        <form class="col-1" action="/recipe/rateRecipe/<%= recipe.id %>?_method=PUT" method="POST">
          <button class="btn btn-primary fa fa-heart" type="submit"></button>
        </form>
        <h3 class="col-3">Likes: <%= recipe.rating %></h3>
        <%if(recipe.user == user.id){ %>
        <form action="/recipe/deleteRecipe/<%= recipe.id %>?_method=DELETE" method="POST" class="col-3">
          <button class="btn btn-primary fa fa-trash" type="submit"></button>
        </form>
        <%}%>
      </div>
    </div>
<%# View recipe entry %>
  <% if (recipe.status === "done") { %>
      <h1><%= recipe.name %></h1>
      <h2><%= recipe.note %></h2>
    <% if (recipe.ingredientCount === 1) { %>
      <h3><%= recipe.ingredients[i] %></h3>
      <h3><%= recipe.measurements[i] %></h3>
    <% } else {%>
      <% for (i=0; i<recipe.ingredientCount; i++) { %>
        <h3><%= recipe.ingredients[i] %></h3>
        <h3><%= recipe.measurements[i] %></h3>
      <%}%>
    <% } %>
    <% if (recipe.stepCount === 1) { %>
      <h3><%= recipe.steps %></h3>
    <% } else {%>
      <% for (i=0; i<recipe.stepCount; i++) { %>
        <h3><%= recipe.steps[0][i] %></h3>
      <%}%>
    <%}%>
    <div>
      <form class="col-1" action="/recipe/editRecipeStatus/<%= recipe._id %>?_method=PUT" method="POST">
        <input type="hidden" class="form-control" id="status" name="status" value="edit">
        <button type="submit" class="btn btn-primary">EDIT</button>
      </form>
    </div>
  <%}%>
  <%# EDIT recipe %>
  <% if (recipe.status === "edit") { %>
    <div class="mt-5">
      <h2>Edit <%= recipe.name %></h2>
      <form action="/recipe/editRecipe/<%= recipe.id %>?_method=PUT" method="POST">
        <div class="mb-3">
          <label for="name" class="form-label">Edit Name</label>
          <input type="text" class="form-control" id="name" name="name" value="<%= recipe.name %>" placeholder="<%= recipe.name %>">
        </div>
        <div class="mb-3">
          <label for="note" class="form-label">Note</label>
          <input class="form-control" id="note" name="note" value="<%= recipe.note %>" placeholder="<%= recipe.note %>"></input>
        </div> 
        <% if (recipe.ingredientCount === 1) { %>
          <div class="mb-3">
            <label for="ingredient" class="form-label">Ingredients</label>
            <input class="form-control" id="ingredient" name="ingredient" value="<%= recipe.ingredients[i] %>" placeholder="<%= recipe.ingredients[i] %>"></input>
          </div>
          <div class="mb-3">
            <label for="measurement" class="form-label">Measurement</label>
            <input class="form-control" id="measurement" name="measurement" value="<%= recipe.measurements[i] %>" placeholder="<%= recipe.measurements[i] %>"></input>
          </div>
        <% } %>
        <% if (recipe.ingredientCount > 1) { %>
          <% for (i=0; i<recipe.ingredientCount; i++) { %>
            <div class="mb-3">
              <label for="ingredient" class="form-label">Ingredients</label>
              <input class="form-control" id="ingredient" name="ingredient" value="<%= recipe.ingredients[i] %>" placeholder="<%= recipe.ingredients[i] %>"></input>
            </div>
            <div class="mb-3">
              <label for="measurement" class="form-label">Measurement</label>
              <input class="form-control" id="measurement" name="measurement" value="<%= recipe.measurements[i] %>" placeholder="<%= recipe.measurements[i] %>"></input>
            </div>
            <button type="submit" class="btn btn-primary" name="deleteIngredient" formaction="/recipe/subtractIngredient/<%= recipe._id %>/<%= i %>?_method=PUT">Subtract Ingredient</button>
          <%}%>
        <% } %>    
        <button type="submit" class="btn btn-primary" formaction="/recipe/addIngredient/<%= recipe._id %>?_method=PUT">Add Ingredient</button>
        <% if (recipe.stepCount === 1) { %>
          <div class="mb-3">
            <label for="steps" class="form-label">Steps</label>
            <input class="form-control" id="steps" name="steps" value="<%= recipe.steps %>" placeholder="<%= recipe.steps %>"></input>
          </div>
        <% } %>
        <% if (recipe.stepCount > 1) { %>
          <% for (i=0; i<recipe.stepCount; i++) { %>
            <div class="mb-3">
              <label for="steps" class="form-label">Steps</label>
              <input class="form-control" id="steps" name="steps" value="<%= recipe.steps[i] %>" placeholder="<%= recipe.steps[i] %>"></input>
            </div>
            <button type="submit" class="btn btn-primary" formaction="/recipe/subtractStep/<%= recipe._id %>/<%= i %>?_method=PUT">Subtract Step</button>
          <%}%>
        <% } %>
        <button type="submit" class="btn btn-primary" formaction="/recipe/addStep/<%= recipe._id %>?_method=PUT">Add Step</button>
        <div class="mb-3">
          <label for="imgUpload" class="form-label">Replace Image</label>
          <input type="file" class="form-control" id="imageUpload" name="file">
        </div>
        <input type="hidden" class="form-control" id="status" name="status" value="done">
        <button type="submit" class="btn btn-primary" value="Upload">Save</button>
      </form>
    </div>
  <%}%>
  <div class="col-6 mt-5">
    <a class="btn btn-primary" href="/recipes">Return to Recipes</a>
    <a class="btn btn-primary" href="/profile">Return to Home</a>
  </div>
</div>
<%- include('partials/footer') -%>
